<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link type="text/css" rel="stylesheet" href="css/style.css"/>
    <title>一号店</title>
</head>
<body>
<!--网页头部-->
<header>
    <div style="float:right" class="i_car">
        <div style="display: block;" class="last">
            <div class="noshop">
                <img src="images/icon_tips2.png" alt=""/>
                <h3>你的1号店购物车还是空的</h3>
            </div>
            <div class="shop">
                <ul>
                    <li >
                        <h4>1号店满199减100 <span class="J_count">共1件商品</span></h4>
                        <div class="clear">
                            <div class="shopImg">
                                <img src="images/shop1.png" alt=""/>
                            </div>
                            <div class="shopText">
                                <div class="clear">
                                    <h5>宝贝许愿坊 童装女装套装 </h5>
                                    <a href="#" class="close J_btnDelete">X</a>
                                </div>
                                <p>深蓝 140码</p>
                                <div class="clear">
                                    <div class="plush">
                                        <span class="J_btnDelCount">-</span>
                                        <input class="J_inputCount" type="text" value="1"/>
                                        <span class="J_btnAddCount">+</span>
                                    </div>
                                    <strong class="J_smallTotalPrice">￥190</strong>
                                </div>
                            </div>
                        </div>
                        <p>参加一项促销，节约成本￥100</p>
                    </li>
                    <li >
                        <h4>1号店 <span class="J_count">共1件商品</span></h4>
                        <div class="clear">
                            <div class="shopImg">
                                <img src="images/shop2.png" alt=""/>
                            </div>
                            <div class="shopText">
                                <div class="clear">
                                    <h5>亨氏 乐维滋清乐2+2果汁 </h5>
                                    <a href="#" class="close J_btnDelete">X</a>
                                </div>
                                <p>草莓山楂枸杞</p>
                                <div class="clear">
                                    <div class="plush">
                                        <span class="J_btnDelCount">-</span>
                                        <input class="J_inputCount" type="text" value="1"/>
                                        <span class="J_btnAddCount">+</span>
                                    </div>
                                    <strong class="J_smallTotalPrice">￥5.8</strong>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li >
                        <h4>珠韵首饰旗舰店 <span class="J_count">共1件商品</span></h4>
                        <div class="clear">
                            <div class="shopImg">
                                <img src="images/shop3.png" alt=""/>
                            </div>
                            <div class="shopText">
                                <div class="clear">
                                    <h5>珠韵首饰 大粒径 9.5-10.5mm近圆白色淡水珍珠项链 送妈妈白色45CM</h5>
                                    <a href="#" class="close J_btnDelete">X</a>
                                </div>
                                <p>淡水白色近圆珍珠</p>
                                <div class="clear">
                                    <div class="plush">
                                        <span class="J_btnDelCount">-</span>
                                        <input class="J_inputCount" type="text" value="1"/>
                                        <span class="J_btnAddCount">+</span>
                                    </div>
                                    <strong class="J_smallTotalPrice">¥758 </strong>
                                </div>
                            </div>
                        </div>
                        <p>全场包邮</p>
                    </li>
                </ul>
                <div class="option"><a href="#">意见反馈</a></div>
                <div class="buy">
                    <p>合计 <span class="J_totalPrice">￥300.8</span></p>
                    <a href="#">立即结算 <span class="J_totalCount">(3)</span></a>
                </div>
            </div>
        </div>
    </div>
</header>

<section>
    <div class="hot_pro" style="float: left">
        <div id="feature">
            <ul class="featureUL">
                <li class="featureBox">
                    <div class="h_icon"><img src="images/hot.png" width="50" height="50"></div>
                    <div class="imgbg">
                        <a href="#"><img src="images/hot1.jpg" width="160" height="136"></a>
                    </div>
                    <div class="name">
                        <a href="#">
                            <h2>德国进口</h2>
                            德亚全脂纯牛奶200ml*48盒
                        </a>
                    </div>
                    <div class="price">
                        <strong>￥<span>189</span></strong> &nbsp; 26R
                    </div>
                </li>
                <li class="featureBox">
                    <div class="h_icon"><img src="images/hot.png" width="50" height="50"></div>
                    <div class="imgbg">
                        <a href="#"><img src="images/hot2.jpg" width="160" height="136"></a>
                    </div>
                    <div class="name">
                        <a href="#">
                            <h2>iphone 6S</h2>
                            Apple/苹果 iPhone 6s Plus公开版
                        </a>
                    </div>
                    <div class="price">
                        <strong>￥<span>5288</span></strong> &nbsp; 25R
                    </div>
                </li>
                <li class="featureBox">
                    <div class="h_icon"><img src="images/hot.png" width="50" height="50"></div>
                    <div class="imgbg">
                        <a href="#"><img src="images/hot3.jpg" width="160" height="136"></a>
                    </div>
                    <div class="name">
                        <a href="#">
                            <h2>倩碧特惠组合套装</h2>
                            倩碧补水组合套装8折促销
                        </a>
                    </div>
                    <div class="price">
                        <strong>￥<span>368</span></strong> &nbsp; 18R
                    </div>
                </li>
                <li class="featureBox">
                    <div class="h_icon"><img src="images/hot.png" width="50" height="50"></div>
                    <div class="imgbg">
                        <a href="#"><img src="images/hot4.jpg" width="160" height="136"></a>
                    </div>
                    <div class="name">
                        <a href="#">
                            <h2>品利特级橄榄油</h2>
                            750ml*4瓶装组合 西班牙原装进口
                        </a>
                    </div>
                    <div class="price">
                        <strong>￥<span>280</span></strong> &nbsp; 30R
                    </div>
                </li>
            </ul>
            <a class="h_prev" href="#">Previous</a>
            <a class="h_next" href="#">Next</a>
        </div>
    </div>
</section>
<script src="js/jquery-1.11.1.min.js"></script>
<script>
    $(function(){
        var addArr=document.getElementsByClassName("J_btnAddCount");
        var delArr=document.getElementsByClassName("J_btnDelCount");
        var price=document.getElementsByClassName("J_smallTotalPrice");
        var J_inputCount=document.getElementsByClassName("J_inputCount");
        var oneP=[190,5.8,758];
//        $(".J_btnAddCount").click(function(){
//            var num=$(this).prev().val();
//            num++;
//            $(this).prev().val(num);
//            var oneP=$(this).parent().next().html().substr(1);
//            $(this).parent().next().html("￥"+oneP*num);
//            console.log(oneP);
//        })
        function total(i){
            if(J_inputCount[i].value!=""){
                price[i].innerText="￥"+(oneP[i])*parseInt(J_inputCount[i].value);
            }
        }

        function closeCar(i){
            var flag;
            flag=confirm("删除该商品？");
            if(flag){
                document.getElementsByClassName("shop")[0].firstElementChild.removeChild(i[0]);
                console.log(i.index());
                var index=i.index()+1;
                console.log(index);
                var newOneP=[];
                for(var j=0;j<index;j++){
                    newOneP[j]=oneP[j];
                }
                for(var k=index;k<oneP.length-1;k++){
                    newOneP[k]=oneP[k+1];
                }
                oneP=newOneP;
            }

        }

        function add(){
            for(let i=0;i<addArr.length;i++){
                addArr[i].onclick=function(){
                    var num=$(this).prev().val();
                    num++;
                    $(this).prev().val(num);
                    $(".J_count").html("共"+num+"件商品");
                    total(i);
                }
            }
        }
        add();
        function del(){
            for(let i=0;i<delArr.length;i++){
                delArr[i].onclick=function(){
                    var num=$(this).next().val();
                    num--;
//                    if(num<0){
//                        num=0;
//                    }
                    if(num<=0){
                        num=1;
                        var dom = $(this).parents("li");
                        closeCar(dom);
                    }
                    $(this).next().val(num);
                    $(".J_count").html("共"+num+"件商品");
                    total(i);
                }
            }
        }
     del();
        $(".buy>a").click(function(){
            var sum=0;
            var num=0;
            for(var i=0;i<price.length;i++){
                sum=sum+parseFloat(price[i].innerText.substr(1));
                num=num+parseInt(J_inputCount[i].value);
            }
            $(".J_totalPrice").html("￥"+sum);
            $(".J_totalCount").html("("+num+")");
        })

        //增加购物车图片
        $(".featureBox").css("position","relative");
        var car=$("<img>");
        car.addClass("cars");
        car.attr("src","images/cars.png");
        car.css({"position":"absolute","top":"200px","right":"10px"});
        $(".featureBox").append(car);
//        console.log($(".cars").length);

        //点击购物车图片，添加到购物车列表
        var name=document.getElementsByClassName("name");
        var close=document.getElementsByClassName("close");
        var length=close.length;
//        console.log(length);
//        console.log($(".shopText>ul"));
        for(let i=0;i<$(".cars").length;i++){
            $(".cars")[i].onclick=function(){
                var proTit=name[i].firstElementChild.firstElementChild.innerText;
                var index=name[i].firstElementChild.innerHTML.indexOf("/h2>");
//                console.log(index);
                var proDta=name[i].firstElementChild.innerHTML.substr(index+4).trim().substr(0,18);//字数太多时只显示20个字符
//                var proDta=name[i].firstElementChild.innerHTML.substr(index+4).trim();
//                console.log(length);
                for(var j=0;j<length-1;j++){
                    var listTit=$(".close").prev()[j].innerText;
                    console.log(listTit);
                    if(proTit==listTit){
                        console.log(j);
                        add();
//                        break;
//                        del();
//                        length++;
//                        console.log(length);
//                        for(let i=0;i<length;i++){
//                            close[i].onclick=function(){
//                                var dom = $(this).parents("li");
//                                closeCar(dom);
//                            }
//                        }
                    }
                    else{
                        var addli=$("<li></li>");
                        $(".shop>ul").append(addli);
                        var h4=$("<h4></h4>");
                        h4.html("热门");
                        addli.append(h4);
                        var clear=$("<div></div>");
                        clear.addClass("clear");
                        addli.append(clear);
                        shopImg=$("<div></div>");
                        shopImg.addClass("shopImg");
                        clear.append(shopImg);
                        var img=$("<img>");
                        img.attr("src","images/hot"+(i+1)+".jpg");
                        img.css("float","left");
                        shopImg.append(img);
                        var shopText=$("<div></div>");
                        shopText.addClass("shopText");
                        shopText.css("float","right");
                        clear.append(shopText);
                        var clear=$("<div></div>");
                        clear.addClass("clear");
                        shopText.append(clear);
//                var proTit=name[i].firstElementChild.firstElementChild.innerText;
//                var index=name[i].firstElementChild.innerHTML.indexOf("/h2>");
////                console.log(index);
//                var proDta=name[i].firstElementChild.innerHTML.substr(index+4).trim().substr(0,18);//字数太多时只显示20个字符
////                var proDta=name[i].firstElementChild.innerHTML.substr(index+4).trim();
                        var h5=$("<h5></h5>");
                        h5.html(proTit);
//                console.log(h5.html());
                        shopText.append(h5);
//               clear.append(h5);
                        var a=$("<a></a>");
                        a.addClass("close J_btnDelete");
                        a.html("X");
                        shopText.append(a);
//                clear.append(h5);
                        var p=$("<p></p>");
//                p.css({"width":"156px","overflow":"hidden","white-space":"nowrap","text-overflow":"ellipsis","line-height":"22px"});
                        p.html(proDta);
                        shopText.append(p);
                        var clear=$("<div></div>");
                        clear.addClass("clear");
                        shopText.append(clear);
                        var plush=$("<div></div>");
                        plush.addClass("plush");
                        clear.append(plush);
                        var DelCount=$("<span></span>");
                        DelCount.addClass("J_btnDelCount");
                        DelCount.html("-");
                        plush.append(DelCount);
                        var inputCount=$("<input>");
                        inputCount.addClass("J_inputCount");
                        inputCount.attr("value","1");
                        plush.append(inputCount);
                        var AddCount=$("<span></span>");
                        AddCount.addClass("J_btnAddCount");
                        AddCount.html("+");
                        plush.append(AddCount);
                        var totalP=$("<strong></strong>");
                        totalP.addClass("J_smallTotalPrice");
                        var onePrice=$(".price>strong>span")[i].innerText;
//                console.log(onePrice);
                        totalP.html("￥"+onePrice);
                        clear.append(totalP);
//                addArr.length++;
//                delArr.length++;
                        oneP.push(onePrice);
                        add();
                        del();
                        length++;
                        console.log(length);
                        for(let i=0;i<length;i++){
                            close[i].onclick=function(){
                                var dom = $(this).parents("li");
                                closeCar(dom);
                            }
                        }
//                        break;
                    }

                }


            }

        }

//        console.log(close.length);
        for(let i=0;i<close.length;i++){
            close[i].onclick=function(){
                var dom = $(this).parents("li");
//                console.log(dom.index());
                closeCar(dom);
            }
        }



    })
</script>
</body>
</html>
